# TechForum 开发计划文档

## 📅 总体时间规划

**项目周期**: 8-10周  
**开始日期**: 2025-01-15  
**预计完成**: 2025-03-15

---

## 🎯 第一阶段：基础完善（第1-2周）

### 本阶段目标
✅ 完善数据库设计  
✅ 优化参数校验  
✅ 实现分区功能  
✅ 完善日志系统  
✅ 优化分页查询

---

### 第1周：数据库设计 + 分区功能

#### Day 1（周一）：数据库表结构设计

**上午任务**:
- [ ] 创建新数据库 `tech_forum`
- [x] 执行users表补充字段SQL
- [ ] ~~补充user对应新增操作,Entity,Mapper,(Sever,controller)?~~
- [x] 执行posts表补充字段SQL
- [ ] 执行comments表补充字段SQL

**下午任务**:
- [ ] 创建categories分区表
- [ ] 创建likes点赞表
- [ ] 创建collects收藏表
- [ ] 创建follows关注表

**晚上学习**:
- 画出完整的E-R图（使用dbdiagram.io）
- 理解外键约束的作用
- 学习数据库索引优化

**检查清单**:
- [ ] 所有表创建成功
- [ ] 外键约束生效
- [ ] 索引创建完成
- [ ] 初始化categories数据

---

#### Day 2（周二）：Category分区功能实现

**上午任务**:
- [ ] 创建Category实体类
```java
@Data
public class Category {
    private Long id;
    private String name;
    private String description;
    private String icon;
    private Integer postCount;
    private Integer sortOrder;
    private Boolean isActive;
    private LocalDateTime createTime;
}
```

- [ ] 创建CategoryMapper
```java
@Mapper
public interface CategoryMapper {
    @Select("SELECT * FROM categories WHERE is_active = TRUE ORDER BY sort_order DESC")
    List<Category> findAll();
    
    @Select("SELECT * FROM categories WHERE id = #{id}")
    Category findById(Long id);
    
    @Insert("INSERT INTO categories(name, description, sort_order) VALUES(#{name}, #{description}, #{sortOrder})")
    @OptionuseGeneratedKeys = true, keyProperty = "id")
    int insert(Category category);
}
```

**下午任务**:
- [ ] 创建CategoryService接口和实现类
- [ ] 创建CategoryController
```java
@RestController
@RequestMapping("/api/categories")
public class CategoryController {
    @GetMapping
    public Result<List<Category>> getAllCategories() {
        // 获取所有分区
    }
}
```

**晚上学习**:
- 复习@Mapper注解的作用
- 理解@Options注解获取主键
- 写博客：MyBatis基础注解使用

**检查清单**:
- [ ] API测试通过
- [ ] 能正确返回分区列表
- [ ] 代码有注释

---

#### Day 3（周三）：Post关联Category

**上午任务**:
- [ ] 修改PostMapper，添加category_id查询
```java
@Select("SELECT p.*, c.name as categoryName FROM posts p " +
        "LEFT JOIN categories c ON p.category_id = c.id " +
        "WHERE p.id = #{id}")
Post findByIdWithCategory(Long id);
```

- [ ] 修改Post实体类，添加categoryName字段
- [ ] 修改PostService，获取帖子时关联分区信息

**下午任务**:
- [ ] 实现按分区查询帖子
```java
@Select("SELECT * FROM posts WHERE category_id = #{categoryId} AND status = 2 " +
        "ORDER BY update_time DESC LIMIT #{offset}, #{size}")
List<Post> findByCategoryId(@Param("categoryId") Long categoryId, 
                            @Param("offset") int offset, 
                            @Param("size") int size);
```

- [ ] 在PostController添加分区过滤参数
- [ ] 测试API：`GET /api/posts?categoryId=1&page=1&size=20`

**晚上学习**:
- 学习MyBatis的LEFT JOIN使用
- 理解一对多关系映射
- 复习SQL的多表查询

**检查清单**:
- [ ] 能按分区查询帖子
- [ ] 帖子详情返回分区名称
- [ ] API测试通过

---

#### Day 4（周四）：参数校验优化

**上午任务**:
- [ ] 添加validation依赖（如果没有）
```xml
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-validation</artifactId>
</dependency>
```

- [ ] 给实体类添加校验注解
```java
@Data
public class Post {
    @NotBlank(message = "标题不能为空")
    @Size(min = 5, max = 100, message = "标题长度5-100字符")
    private String title;
    
    @NotBlank(message = "内容不能为空")
    @Size(min = 10, message = "内容至少10个字符")
    private String content;
}
```

**下午任务**:
- [ ] 在Controller启用校验
```java
@PostMapping
public ResponseEntity<Result<Post>> createPost(@Valid @RequestBody Post post) {
    // Spring自动校验
}
```

- [ ] 添加全局异常处理
```java
@ExceptionHandler(MethodArgumentNotValidException.class)
public ResponseEntity<Result> handleValidationException(MethodArgumentNotValidException e) {
    String message = e.getBindingResult().getFieldError().getDefaultMessage();
    return ResponseEntity.status(HttpStatus.BAD_REQUEST)
        .body(Result.error(message));
}
```

**晚上学习**:
- 学习@Valid和@Validated的区别
- 理解Spring的参数校验机制
- 写博客：Spring Boot参数校验最佳实践

**检查清单**:
- [ ] 参数校验生效
- [ ] 能返回友好的错误提示
- [ ] 测试各种非法输入

---

#### Day 5（周五）：分页优化

**上午任务**:
- [ ] 分析现有分页查询的问题
```java
// 问题：LIMIT 10000, 20 性能差
// SELECT * FROM posts ORDER BY id DESC LIMIT 10000, 20;
```

- [ ] 实现游标分页
```java
@Select("SELECT * FROM posts WHERE id < #{lastId} AND status = 2 " +
        "ORDER BY id DESC LIMIT #{size}")
List<Post> findByPageWithCursor(@Param("lastId") Long lastId, 
                                @Param("size") int size);
```

**下午任务**:
- [ ] 修改PostController支持游标分页
```java
@GetMapping
public Result getPosts(
    @RequestParam(required = false) Long lastId,  // 上一页最后一条ID
    @RequestParam(defaultValue = "20") int size
) {
    List<Post> posts = postService.getPostsByCursor(lastId, size);
    return Result.success(posts);
}
```

- [ ] 前端兼容：保留原page参数，但限制最大页数
- [ ] 性能测试对比

**晚上学习**:
- 理解深分页问题
- 学习游标分页原理
- 写博客：MySQL分页优化方案

**检查清单**:
- [ ] 游标分页实现成功
- [ ] 性能有提升
- [ ] API向后兼容

---

#### Day 6（周六）：日志系统完善

**上午任务**:
- [ ] 配置logback-spring.xml（如果没有）
- [ ] 在Service层添加关键操作日志
```java
@Slf4j
@Service
public class PostServiceImpl {
    public Post createPost(Post post) {
        log.info("用户[{}]发布帖子: {}", 
            SecurityUtil.getCurrentUser().getUsername(),
            post.getTitle());
        // ...
    }
    
    public void deletePost(Long postId) {
        log.warn("用户[{}]删除帖子[{}]", 
            SecurityUtil.getCurrentUser().getUsername(),
            postId);
        // ...
    }
}
```

**下午任务**:
- [ ] 添加异常日志
- [ ] 添加慢查询日志
- [ ] 测试日志输出

**晚上学习**:
- 学习日志级别（DEBUG/INFO/WARN/ERROR）
- 理解日志的作用
- 了解ELK日志系统（扩展知识）

---

#### Day 7（周日）：周总结

**上午任务**:
- [ ] 整理本周代码，添加注释
- [ ] 测试所有接口
- [ ] 修复发现的bug

**下午任务**:
- [ ] 画流程图：Spring Security过滤器链
- [ ] 画流程图：帖子发布流程
- [ ] 画流程图：帖子查询流程

**晚上学习**:
- 写周总结博客
- 复习本周学到的知识点
- 准备下周任务

**本周成果**:
- ✅ 13张数据库表全部创建
- ✅ 分区功能完整实现
- ✅ 参数校验优化完成
- ✅ 分页查询优化
- ✅ 日志系统完善

---

### 第2周：异常处理 + Redis准备

#### Day 8（周一）：异常体系重构

**任务**:
- [ ] 梳理现有异常类型
- [ ] 创建统一的业务异常基类BizException
- [ ] 完善GlobalExceptionHandler
- [ ] 测试各种异常场景

**学习重点**:
- 理解异常处理的最佳实践
- 学习HTTP状态码的使用

---

#### Day 9-10（周二-周三）：Redis环境搭建

**任务**:
- [ ] 安装Redis（Docker方式推荐）
- [ ] 配置Spring Boot连接Redis
- [ ] 写Redis测试用例
- [ ] 学习Redis的5种数据类型

**学习重点**:
- Redis基础命令
- String、Hash、List、Set、ZSet的使用场景

---

#### Day 11-12（周四-五）：缓存功能实现

**任务**:
- [ ] 实现帖子详情缓存
- [ ] 实现热门帖子缓存
- [ ] 实现分区列表缓存
- [ ] 设置合理的过期时间

---

#### Day 13-14（周末）：总结 + 补充

**任务**:
- [ ] 写技术博客：Redis缓存实践
- [ ] 准备第二阶段任务
- [ ] 复习第一阶段知识点

---

## 🎯 第二阶段：图片与互动（第3-4周）

### 本阶段目标
✅ 搭建MinIO图片存储  
✅ 实现图片上传功能  
✅ 实现点赞功能  
✅ 实现收藏功能  
✅ 实现关注功能  
✅ 浏览量统计

---

### 第3周：MinIO + 图片上传

#### Day 15（周一）：MinIO环境搭建

**上午任务**:
- [ ] Docker安装MinIO
```bash
docker run -p 9000:9000 -p 9001:9001 \
  --name minio \
  -e "MINIO_ROOT_USER=admin" \
  -e "MINIO_ROOT_PASSWORD=admin123" \
  minio/minio server /data --console-address ":9001"
```

- [ ] 访问MinIO控制台（http://localhost:9001）
- [ ] 创建bucket：`forum-images`

**下午任务**:
- [ ] 添加MinIO依赖
```xml
<dependency>
    <groupId>io.minio</groupId>
    <artifactId>minio</artifactId>
    <version>8.5.7</version>
</dependency>
```

- [ ] 配置application.yml
```yaml
minio:
  endpoint: http://localhost:9000
  access-key: admin
  secret-key: admin123
  bucket: forum-images
```

**晚上学习**:
- 了解对象存储概念
- 学习MinIO基本操作
- 对比云存储方案（阿里云OSS/腾讯云COS）

---

#### Day 16（周二）：文件上传Service

**上午任务**:
- [ ] 创建MinioConfig配置类
```java
@Configuration
public class MinioConfig {
    @Value("${minio.endpoint}")
    private String endpoint;
    
    @Bean
    public MinioClient minioClient() {
        return MinioClient.builder()
            .endpoint(endpoint)
            .credentials(accessKey, secretKey)
            .build();
    }
}
```

**下午任务**:
- [ ] 创建FileService
```java
@Service
public class FileService {
    @Autowired
    private MinioClient minioClient;
    
    public String uploadImage(MultipartFile file) {
        // 1. 文件类型校验
        // 2. 文件大小校验（5MB）
        // 3. 生成唯一文件名
        // 4. 上传到MinIO
        // 5. 返回访问URL
    }
}
```

**晚上学习**:
- 学习文件上传安全防护
- 理解UUID生成文件名
- 了解图片处理库（Thumbnailator）

---

#### Day 17（周三）：用户头像上传

**任务**:
- [ ] 实现上传头像接口
- [ ] 更新用户avatar_url字段
- [ ] 测试上传功能
- [ ] 处理旧头像删除

---

#### Day 18-19（周四-五）：帖子图片上传

**任务**:
- [ ] 实现富文本图片上传
- [ ] 前端对接（Markdown编辑器）
- [ ] 图片防盗链（可选）
- [ ] 图片压缩优化（可选）

---

#### Day 20-21（周末）：本周总结

**任务**:
- [ ] 测试所有上传功能
- [ ] 写技术博客：MinIO实战
- [ ] 准备下周任务

---

### 第4周：点赞收藏关注

#### Day 22-23（周一-二）：点赞功能

**核心逻辑**:
```java
@Service
public class LikeServiceImpl {
    public void likePost(Long postId) {
        // 1. 检查是否已点赞（Redis Set）
        // 2. 记录点赞（Redis + MySQL）
        // 3. 更新帖子点赞数
        // 4. 发送通知
    }
}
```

**任务清单**:
- [ ] 创建LikeService
- [ ] 实现点赞接口
- [ ] 实现取消点赞接口
- [ ] 查询用户是否点赞过
- [ ] 定时任务同步Redis到MySQL

---

#### Day 24-25（周三-四）：收藏 + 关注功能

**任务**:
- [ ] 实现收藏功能
- [ ] 实现关注功能
- [ ] 我的收藏列表
- [ ] 我的关注/粉丝列表

---

#### Day 26（周五）：浏览量统计

**任务**:
- [ ] 记录帖子浏览（Redis计数）
- [ ] 记录浏览历史
- [ ] 防止重复统计（同一用户1分钟内只计数1次）

---

#### Day 27-28（周末）：阶段总结

**任务**:
- [ ] 完整测试所有功能
- [ ] 写技术博客：高并发点赞系统设计
- [ ] 准备第三阶段

---

## 🎯 第三阶段：通知与搜索（第5-6周）

### 第5周：通知系统

#### Day 29-31（周一-三）：通知功能实现

**任务**:
- [ ] 创建NotificationService
- [ ] 点赞通知
- [ ] 评论通知
- [ ] 关注通知
- [ ] @提及通知
- [ ] 系统通知

---

#### Day 32-33（周四-五）：私信功能

**任务**:
- [ ] 实现发送私信
- [ ] 获取会话列表
- [ ] 获取聊天记录
- [ ] 未读消息统计

---

### 第6周：搜索功能

#### Day 36-38（周一-三）：MySQL搜索

**任务**:
- [ ] 实现标题+内容模糊搜索
- [ ] 搜索结果高亮（可选）
- [ ] 热门搜索词统计

---

#### Day 39-42（周四-日）：优化 + 总结

**任务**:
- [ ] 性能优化
- [ ] 完整测试
- [ ] 写技术博客

---

## 🎯 第四阶段：管理后台（第7周）

### 管理功能实现

**任务**:
- [ ] 帖子审核功能
- [ ] 举报处理
- [ ] 用户管理
- [ ] 用户管理
  - [ ] 查看用户列表
  - [ ] 封禁/解封用户
  - [ ] 用户注销功能
    **测试清单**:
      - [ ] 注销后用户名显示为"账号已注销"
      - [ ] 帖子/评论保留且显示正常
      - [ ] 隐私数据(邮箱/密码)已清空
      - [ ] 无法用原账号重新登录
      - [ ] 可以用原用户名重新注册
    **学习重点**:
      - 软删除vs硬删除的区别
      - GDPR数据保护法规
      - 用户数据匿名化技术
      - Spring Security权限控制
- [ ] 数据统计Dashboard

---

## 🎯 第五阶段：优化与部署（第8-10周）

### 第8周：性能优化

**任务**:
- [ ] Redis缓存优化
- [ ] 数据库索引优化
- [ ] 接口限流
- [ ] SQL慢查询优化

---

### 第9周：前端对接

**任务**:
- [ ] 前端项目搭建（Vue3 + Element Plus）
- [ ] 接口联调
- [ ] 功能测试

---

### 第10周：部署上线

**任务**:
- [ ] Docker容器化
- [ ] 服务器部署
- [ ] 域名配置
- [ ] 压力测试

---

## 📊 进度追踪表

| 阶段 | 任务 | 状态 | 完成日期 |
|------|------|------|----------|
| 第1周 | 数据库设计 | ⏳ 进行中 | - |
| 第1周 | 分区功能 | ⏳ 进行中 | - |
| 第1周 | 参数校验 | ⏳ 进行中 | - |
| 第2周 | Redis准备 | ⬜ 未开始 | - |
| 第3周 | MinIO搭建 | ⬜ 未开始 | - |
| 第3周 | 图片上传 | ⬜ 未开始 | - |
| 第4周 | 点赞收藏 | ⬜ 未开始 | - |

---

## 💡 每日工作流程建议

### 上午（9:00-12:00）
1. 回顾昨天学到的内容（15分钟）
2. 看今日任务清单，明确目标（15分钟）
3. 开始编码实现（2.5小时）

### 下午（14:00-18:00）
1. 继续完成任务（2小时）
2. 写单元测试（1小时）
3. API测试验证（1小时）

### 晚上（19:00-21:00）
1. 整理代码注释（30分钟）
2. 学习原理知识（1小时）
3. 写技术博客/总结（30分钟）

---

## ✅ 每日检查清单

- [ ] 代码有注释吗？
- [ ] 异常处理完善吗？
- [ ] 参数校验做了吗？
- [ ] 日志记录添加了吗？
- [ ] API测试通过了吗？
- [ ] 能给面试官讲清楚原理吗？
- [ ] 今天学到的知识记录了吗？

---

## 🎓 学习建议

### 遇到问题的解决步骤
1. **先查官方文档** - 80%的问题文档里都有答案
2. **画流程图理解** - 把不懂的流程画出来
3. **写Demo验证** - 单独测试不懂的技术点
4. **记录问题和解决方案** - 写成博客加深理解
5. **问AI辅助理解** - 但要验证答案的正确性

### 技术博客主题建议
- Spring Boot参数校验最佳实践
- MyBatis动态SQL深入理解
- MySQL分页优化方案
- Redis缓存实践
- MinIO对象存储实战
- 高并发点赞系统设计
- Spring Security认证流程详解

---

**文档版本**: v1.0  
**最后更新**: 2025-01-15  
**下次更新**: 每周日晚