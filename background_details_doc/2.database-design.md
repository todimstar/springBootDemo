# TechForum æ•°æ®åº“è®¾è®¡æ–‡æ¡£

## ğŸ“Š æ•°æ®åº“æ¦‚è§ˆ

**æ•°æ®åº“åç§°**: `tech_forum`  
**å­—ç¬¦é›†**: `utf8mb4`  
**æ’åºè§„åˆ™**: `utf8mb4_unicode_ci`  
**æ€»è¡¨æ•°**: 13å¼ 

---

## ğŸ“‹ è¡¨æ¸…å•

| åºå· | è¡¨å | è¯´æ˜ | çŠ¶æ€ |
|------|------|------|------|
| 1 | users | ç”¨æˆ·è¡¨ | âœ… éœ€è¡¥å……å­—æ®µ |
| 2 | posts | å¸–å­è¡¨ | âœ… éœ€è¡¥å……å­—æ®µ |
| 3 | comments | è¯„è®ºè¡¨ | âœ… éœ€è¡¥å……å­—æ®µ |
| 4 | categories | åˆ†åŒºè¡¨ | âŒ å¾…åˆ›å»º |
| 5 | likes | ç‚¹èµè¡¨ | âŒ å¾…åˆ›å»º |
| 6 | collects | æ”¶è—è¡¨ | âŒ å¾…åˆ›å»º |
| 7 | follows | å…³æ³¨è¡¨ | âŒ å¾…åˆ›å»º |
| 8 | notifications | é€šçŸ¥è¡¨ | âŒ å¾…åˆ›å»º |
| 9 | messages | ç§ä¿¡è¡¨ | âŒ å¾…åˆ›å»º |
| 10 | reports | ä¸¾æŠ¥è¡¨ | âŒ å¾…åˆ›å»º |
| 11 | browsing_history | æµè§ˆå†å²è¡¨ | âŒ å¾…åˆ›å»º |
| 12 | tags | æ ‡ç­¾è¡¨ï¼ˆå¯é€‰ï¼‰ | âš ï¸ åæœŸ |
| 13 | post_tags | å¸–å­æ ‡ç­¾å…³è”è¡¨ï¼ˆå¯é€‰ï¼‰ | âš ï¸ åæœŸ |

---

## ğŸ—ƒï¸ å®Œæ•´å»ºè¡¨SQL

### 1. ç”¨æˆ·è¡¨ï¼ˆusersï¼‰

```sql
*DROP TABLE IF EXISTS `users`;
CREATE TABLE `users` (
    `id` BIGINT NOT NULL AUTO_INCREMENT COMMENT 'ç”¨æˆ·ID',
    `username` VARCHAR(50) NOT NULL COMMENT 'ç”¨æˆ·å',
    `password` VARCHAR(255) NOT NULL COMMENT 'åŠ å¯†åçš„å¯†ç ',
    `email` VARCHAR(100) NOT NULL COMMENT 'é‚®ç®±',
    `avatar_url` VARCHAR(255) DEFAULT '/default-avatar.png' COMMENT 'å¤´åƒURL',
    `gender` TINYINT DEFAULT 0 COMMENT 'æ€§åˆ«ï¼š0æœªçŸ¥,1ç”·,2å¥³',
    `bio` VARCHAR(500) DEFAULT '' COMMENT 'ä¸ªäººç®€ä»‹',
    `location` VARCHAR(100) DEFAULT '' COMMENT 'æ‰€åœ¨åœ°',
    `points` INT DEFAULT 0 COMMENT 'ç§¯åˆ†',
    `level` INT DEFAULT 1 COMMENT 'ç”¨æˆ·ç­‰çº§',
    `is_banned` BOOLEAN DEFAULT FALSE COMMENT 'æ˜¯å¦è¢«å°ç¦',
    `ban_reason` VARCHAR(255) COMMENT 'å°ç¦åŸå› ',
    `ban_until` DATETIME COMMENT 'å°ç¦æˆªæ­¢æ—¶é—´',
    `create_time` DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
    `last_login_time` DATETIME DEFAULT NULL COMMENT 'æœ€åç™»å½•æ—¶é—´',
    `role` VARCHAR(50) NOT NULL DEFAULT 'ROLE_USER' COMMENT 'ç”¨æˆ·è§’è‰²ï¼šROLE_USER, ROLE_ADMIN',
    PRIMARY KEY (`id`),
    UNIQUE KEY `uk_username` (`username`),
    UNIQUE KEY `uk_email` (`email`),
    KEY `idx_username` (`username`),
    KEY `idx_create_time` (`create_time`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='ç”¨æˆ·è¡¨';*
```

**å­—æ®µè¯´æ˜ï¼š**
- `avatar_url`: å¤´åƒURLï¼Œé»˜è®¤ä½¿ç”¨ç³»ç»Ÿå¤´åƒ
- `gender`: 0æœªçŸ¥/1ç”·/2å¥³ï¼Œä½¿ç”¨TINYINTèŠ‚çœç©ºé—´
- `points/level`: ä¸ºåç»­ç”¨æˆ·ç­‰çº§ä½“ç³»é¢„ç•™
- `is_banned`: è½¯åˆ é™¤ï¼Œä¿ç•™ç”¨æˆ·æ•°æ®
- `role`: ç®€åŒ–ç‰ˆåªæœ‰USERå’ŒADMINï¼Œå¤æ‚æƒé™å¯æ‰©å±•

---

### 2. å¸–å­è¡¨ï¼ˆpostsï¼‰

```sql
DROP TABLE IF EXISTS `posts`;
CREATE TABLE `posts` (
    `id` BIGINT NOT NULL AUTO_INCREMENT COMMENT 'å¸–å­ID',
    `user_id` BIGINT NOT NULL COMMENT 'ä½œè€…ID',
    `category_id` BIGINT DEFAULT NULL COMMENT 'åˆ†åŒºID',
    `title` VARCHAR(255) NOT NULL COMMENT 'å¸–å­æ ‡é¢˜',
    `content` LONGTEXT NOT NULL COMMENT 'å¸–å­å†…å®¹ï¼ˆMarkdownæ ¼å¼ï¼‰',
    `cover_image` VARCHAR(255) DEFAULT NULL COMMENT 'å°é¢å›¾URL',
    `view_count` INT DEFAULT 0 COMMENT 'æµè§ˆé‡',
    `like_count` INT DEFAULT 0 COMMENT 'ç‚¹èµæ•°',
    `collect_count` INT DEFAULT 0 COMMENT 'æ”¶è—æ•°',
    `comment_count` INT DEFAULT 0 COMMENT 'è¯„è®ºæ•°',
    `status` TINYINT DEFAULT 1 COMMENT 'çŠ¶æ€ï¼š0è‰ç¨¿,1å¾…å®¡æ ¸,2å·²å‘å¸ƒ,3å·²æ‹’ç»,4å·²åˆ é™¤',
    `is_pinned` BOOLEAN DEFAULT FALSE COMMENT 'æ˜¯å¦ç½®é¡¶',
    `is_essence` BOOLEAN DEFAULT FALSE COMMENT 'æ˜¯å¦åŠ ç²¾',
    `ip_address` VARCHAR(50) COMMENT 'å‘å¸ƒè€…IP',
    `create_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
    `update_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',
    PRIMARY KEY (`id`),
    KEY `idx_user_id` (`user_id`),
    KEY `idx_category_id` (`category_id`),
    KEY `idx_status` (`status`),
    KEY `idx_create_time` (`create_time`),
    KEY `idx_update_time` (`update_time`),
    KEY `idx_view_count` (`view_count`),
    KEY `idx_like_count` (`like_count`),
    KEY `idx_hot` (`like_count`, `comment_count`, `view_count`) COMMENT 'çƒ­åº¦ç»¼åˆç´¢å¼•',
    CONSTRAINT `fk_posts_users` FOREIGN KEY (`user_id`) REFERENCES `users` (`id`) ON DELETE CASCADE,
    CONSTRAINT `fk_posts_categories` FOREIGN KEY (`category_id`) REFERENCES `categories` (`id`) ON DELETE SET NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='å¸–å­è¡¨';
```

**é‡è¦ç´¢å¼•è¯´æ˜ï¼š**
- `idx_hot`: ç»„åˆç´¢å¼•ï¼Œç”¨äºçƒ­é—¨æ’åºæŸ¥è¯¢
- `idx_update_time`: ç”¨äº"æœ€æ–°"æ’åº
- `idx_category_id`: ç”¨äºæŒ‰åˆ†åŒºæŸ¥è¯¢

**çŠ¶æ€è¯´æ˜ï¼š**
- 0: è‰ç¨¿ï¼ˆç”¨æˆ·ä¿å­˜ä½†æœªå‘å¸ƒï¼‰
- 1: å¾…å®¡æ ¸ï¼ˆéœ€è¦ç®¡ç†å‘˜å®¡æ ¸çš„åœºæ™¯ï¼‰
- 2: å·²å‘å¸ƒï¼ˆæ­£å¸¸å±•ç¤ºï¼‰
- 3: å·²æ‹’ç»ï¼ˆå®¡æ ¸æœªé€šè¿‡ï¼‰
- 4: å·²åˆ é™¤ï¼ˆè½¯åˆ é™¤ï¼‰

---

### 3. è¯„è®ºè¡¨ï¼ˆcommentsï¼‰

```sql
DROP TABLE IF EXISTS `comments`;
CREATE TABLE `comments` (
    `id` BIGINT NOT NULL AUTO_INCREMENT COMMENT 'è¯„è®ºID',
    `post_id` BIGINT NOT NULL COMMENT 'å¸–å­ID',
    `user_id` BIGINT NOT NULL COMMENT 'è¯„è®ºè€…ID',
    `parent_id` BIGINT DEFAULT NULL COMMENT 'çˆ¶è¯„è®ºIDï¼Œnullè¡¨ç¤ºä¸€çº§è¯„è®º',
    `reply_to_user_id` BIGINT DEFAULT NULL COMMENT 'å›å¤ç»™è°ï¼ˆ@åŠŸèƒ½ï¼‰',
    `content` TEXT NOT NULL COMMENT 'è¯„è®ºå†…å®¹',
    `like_count` INT DEFAULT 0 COMMENT 'ç‚¹èµæ•°',
    `ip_address` VARCHAR(50) COMMENT 'è¯„è®ºè€…IP',
    `create_time` DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT 'è¯„è®ºæ—¶é—´',
    PRIMARY KEY (`id`),
    KEY `idx_post_id` (`post_id`),
    KEY `idx_user_id` (`user_id`),
    KEY `idx_parent_id` (`parent_id`),
    KEY `idx_create_time` (`create_time`),
    -- è¯„è®ºè·Ÿéšå¸–å­é”€æ¯ï¼Œç¡¬åˆ é™¤
    CONSTRAINT `fk_comments_posts` FOREIGN KEY (`post_id`) REFERENCES `posts` (`id`) ON DELETE CASCADE,
    -- ç”¨æˆ·æ³¨é”€ä¸”ç®¡ç†å‘˜åˆ é™¤idè¯„è®ºé”€æ¯ï¼Œç¡¬åˆ é™¤
    -- `ç”¨æˆ·å·²æ³¨é”€`è½¯åˆ é™¤æ—¶ç”¨æˆ·idä»å­˜ï¼Œåªæ˜¯åœ¨å±•ç¤ºç”¨æˆ·æ—¶æ ¹æ®`users`(is_deleted)åŠ è½½`ç”¨æˆ·å·²æ³¨é”€`
    CONSTRAINT `fk_comments_users` FOREIGN KEY (`user_id`) REFERENCES `users` (`id`) ON DELETE CASCADE,
    -- çˆ¶è¯„è®ºé”€æ¯æ—¶å­è¯„è®ºç¡¬åˆ é™¤
    CONSTRAINT `fk_comments_parent` FOREIGN KEY (`parent_id`) REFERENCES `comments` (`id`) ON DELETE CASCADE,
    -- å›å¤çš„ç”¨æˆ·æ³¨é”€åè½¯åˆ é™¤ï¼Œæ³¨æ„ä¹‹åçš„æ‰€æœ‰è¯„è®ºæŸ¥è¯¢è¦æ£€ç´¢`reply_to_user_id`?é‚£ä¼šå‡ºç°ä¸ºç©ºä½†å…¶å®æ˜¯å›å¤çš„è¯„è®ºé”™ä¹±å•Šï¼Œé‚£å¯èƒ½æ˜¯æ³¨é”€ç”¨æˆ·è½¯åˆ é™¤ç”¨æˆ·idï¼Œç”¨æˆ·idå’Œä¿¡æ¯ä»å­˜åœ¨ç”¨ç”¨æˆ·çš„æ–°åŠ is_deleteå­—æ®µå‰ç«¯åˆ¤æ–­å§ï¼Œè¿™é‡Œå¦‚æœè§¦å‘é‚£å°±æ˜¯æ•°æ®åº“ä¸­åˆ é™¤äº†ï¼Œå°±æ˜¯ç®¡ç†å‘˜å‡ºæ‰‹å†³å®šåˆ é™¤è€Œä¸æ˜¯æ³¨é”€ï¼Œé‚£åº”è¯¥å¯ä»¥å˜æˆç¡¬åˆ é™¤ï¼Œè¿™é‡Œ
    CONSTRAINT `fk_comments_reply_to` FOREIGN KEY (`reply_to_user_id`) REFERENCES `users` (`id`) ON DELETE SET NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='è¯„è®ºè¡¨';
```

**æ¥¼ä¸­æ¥¼è®¾è®¡ï¼š**
```
ä¸€çº§è¯„è®ºï¼šparent_id = NULL
äºŒçº§è¯„è®ºï¼šparent_id = ä¸€çº§è¯„è®ºID
reply_to_user_id: @æŸä¸ªç”¨æˆ·æ—¶ä½¿ç”¨
```
**è¯„è®ºç»“æ„è¯´æ˜ï¼ˆBç«™å¼ä¸¤å±‚æ‰å¹³åŒ–ï¼‰**ï¼š
  - æ¥¼ä¸»è¯„è®ºï¼šparent_id = NULL
  - æ‰€æœ‰å›å¤ï¼šparent_id = æ¥¼ä¸»è¯„è®ºIDï¼ˆå¹³è¡Œç»“æ„ï¼‰
  - æ˜¾ç¤ºæ–¹å¼ï¼šé€šè¿‡ reply_to_user_id æ˜¾ç¤º"å›å¤@æŸäºº"
  - åˆ é™¤ç­–ç•¥ï¼šç›´æ¥ç‰©ç†åˆ é™¤ï¼ŒCASCADEè‡ªåŠ¨å¤„ç†å­è¯„è®º
---

### 4. åˆ†åŒºè¡¨ï¼ˆcategoriesï¼‰

```sql
DROP TABLE IF EXISTS `categories`;
CREATE TABLE `categories` (
    `id` BIGINT NOT NULL AUTO_INCREMENT COMMENT 'åˆ†åŒºID',
    `name` VARCHAR(50) NOT NULL COMMENT 'åˆ†åŒºåç§°',
    `description` VARCHAR(200) DEFAULT '' COMMENT 'åˆ†åŒºæè¿°',
    `icon` VARCHAR(255) DEFAULT NULL COMMENT 'åˆ†åŒºå›¾æ ‡URL',
    `post_count` INT DEFAULT 0 COMMENT 'å¸–å­æ•°é‡',
    `sort_order` INT DEFAULT 0 COMMENT 'æ’åºæƒé‡ï¼Œæ•°å­—è¶Šå¤§è¶Šé å‰',
    `is_active` BOOLEAN DEFAULT TRUE COMMENT 'æ˜¯å¦å¯ç”¨',
    `create_time` DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
    PRIMARY KEY (`id`),
    UNIQUE KEY `uk_name` (`name`),
    KEY `idx_sort_order` (`sort_order`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='åˆ†åŒºè¡¨';

-- åˆå§‹åŒ–æ•°æ®
INSERT INTO `categories` (`name`, `description`, `sort_order`) VALUES
('æŠ€æœ¯åˆ†äº«', 'ç¼–ç¨‹æŠ€æœ¯ã€ç®—æ³•ã€æ¶æ„è®¾è®¡ç­‰æŠ€æœ¯è®¨è®º', 100),
('èŒåœºç”Ÿæ´»', 'é¢è¯•ç»éªŒã€èŒä¸šè§„åˆ’ã€å·¥ä½œæ„Ÿæ‚Ÿ', 90),
('é—®ç­”æ±‚åŠ©', 'æŠ€æœ¯é—®é¢˜æ±‚åŠ©ã€ä»£ç debug', 80),
('å·¥å…·èµ„æº', 'å¼€å‘å·¥å…·æ¨èã€å­¦ä¹ èµ„æºåˆ†äº«', 70),
('é—²èŠçŒæ°´', 'è½»æ¾è¯é¢˜ã€æ—¥å¸¸é—²èŠ', 60);
```

---

### 5. ç‚¹èµè¡¨ï¼ˆlikesï¼‰

```sql
DROP TABLE IF EXISTS `likes`;
CREATE TABLE `likes` (
    `id` BIGINT NOT NULL AUTO_INCREMENT COMMENT 'ç‚¹èµID',
    `user_id` BIGINT NOT NULL COMMENT 'ç‚¹èµç”¨æˆ·ID',
    `target_id` BIGINT NOT NULL COMMENT 'ç›®æ ‡IDï¼ˆå¸–å­/è¯„è®ºï¼‰',
    `target_type` TINYINT NOT NULL COMMENT 'ç±»å‹ï¼š1å¸–å­,2è¯„è®º',
    `create_time` DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT 'ç‚¹èµæ—¶é—´',
    PRIMARY KEY (`id`),
    UNIQUE KEY `uk_user_target` (`user_id`, `target_id`, `target_type`) COMMENT 'é˜²æ­¢é‡å¤ç‚¹èµ',
    KEY `idx_target` (`target_id`, `target_type`),
    -- ç”¨æˆ·æ³¨é”€å³é”€æ¯å…³ç³»
    CONSTRAINT `fk_likes_users` FOREIGN KEY (`user_id`) REFERENCES `users` (`id`) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='ç‚¹èµè¡¨';
```

**è®¾è®¡è¦ç‚¹ï¼š**

- å”¯ä¸€ç´¢å¼•é˜²æ­¢é‡å¤ç‚¹èµ
- target_typeåŒºåˆ†å¸–å­å’Œè¯„è®º
- çº§è”åˆ é™¤ï¼šç”¨æˆ·åˆ é™¤æ—¶è‡ªåŠ¨åˆ é™¤ç‚¹èµè®°å½•

---

### 6. æ”¶è—è¡¨ï¼ˆcollectsï¼‰

```sql
DROP TABLE IF EXISTS `collects`;
CREATE TABLE `collects` (
    `id` BIGINT NOT NULL AUTO_INCREMENT COMMENT 'æ”¶è—ID',
    `user_id` BIGINT NOT NULL COMMENT 'æ”¶è—ç”¨æˆ·ID',
    `post_id` BIGINT NOT NULL COMMENT 'å¸–å­ID',
    `create_time` DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT 'æ”¶è—æ—¶é—´',
    PRIMARY KEY (`id`),
    UNIQUE KEY `uk_user_post` (`user_id`, `post_id`) COMMENT 'é˜²æ­¢é‡å¤æ”¶è—',
    KEY `idx_user_id` (`user_id`),
    KEY `idx_post_id` (`post_id`),
    -- æ”¶è—ç”¨æˆ·æ³¨é”€åæ”¶è—å…³ç³»ç›´æ¥æ¸…é™¤
    CONSTRAINT `fk_collects_users` FOREIGN KEY (`user_id`) REFERENCES `users` (`id`) ON DELETE CASCADE,
    -- å¸–å­åˆ é™¤åæ”¶è—å…³ç³»æ¸…é™¤ï¼Œåç»­å¯å˜æˆè½¯åˆ é™¤
    CONSTRAINT `fk_collects_posts` FOREIGN KEY (`post_id`) REFERENCES `posts` (`id`) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='æ”¶è—è¡¨';
```

---

### 7. å…³æ³¨è¡¨ï¼ˆfollowsï¼‰

```sql
DROP TABLE IF EXISTS `follows`;
CREATE TABLE `follows` (
    `id` BIGINT NOT NULL AUTO_INCREMENT COMMENT 'å…³æ³¨ID',
    `follower_id` BIGINT NOT NULL COMMENT 'å…³æ³¨è€…ID',
    `followee_id` BIGINT NOT NULL COMMENT 'è¢«å…³æ³¨è€…ID',
    `create_time` DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT 'å…³æ³¨æ—¶é—´',
    PRIMARY KEY (`id`),
    UNIQUE KEY `uk_follower_followee` (`follower_id`, `followee_id`) COMMENT 'é˜²æ­¢é‡å¤å…³æ³¨',
    KEY `idx_follower` (`follower_id`),
    KEY `idx_followee` (`followee_id`),
    CONSTRAINT `fk_follows_follower` FOREIGN KEY (`follower_id`) REFERENCES `users` (`id`) ON DELETE CASCADE,
    CONSTRAINT `fk_follows_followee` FOREIGN KEY (`followee_id`) REFERENCES `users` (`id`) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='å…³æ³¨è¡¨';
```

---

### 8. é€šçŸ¥è¡¨ï¼ˆnotificationsï¼‰

```sql
DROP TABLE IF EXISTS `notifications`;
CREATE TABLE `notifications` (
    `id` BIGINT NOT NULL AUTO_INCREMENT COMMENT 'é€šçŸ¥ID',
    `user_id` BIGINT NOT NULL COMMENT 'æ¥æ”¶è€…ID',
    `type` TINYINT NOT NULL COMMENT 'ç±»å‹ï¼š1ç‚¹èµ,2è¯„è®º,3å…³æ³¨,4ç³»ç»Ÿ,5ç§ä¿¡,6@æåŠ',
    `title` VARCHAR(100) NOT NULL COMMENT 'é€šçŸ¥æ ‡é¢˜',
    `content` TEXT DEFAULT NULL COMMENT 'é€šçŸ¥å†…å®¹',
    -- è·³è½¬åŠŸèƒ½ï¼Œå¯èƒ½æ˜¯æ ¹æ®å…³è”idå’Œtypeé…åˆè·³è½¬ï¼Œæˆ‘è§‰å¾—å¾—åœ¨åŠ ä¸€ä¸ªè·³è½¬urlï¼Ÿä»¥å¤‡å…³è”å¸–å­/è¯„è®º/ç”¨æˆ·ä¹‹å¤–çš„æˆ–è€…åˆ¤æ–­å®Œä¹‹åé¦–æ¬¡æ‹¼æ¥urlå­˜åˆ°è¿™é‡Œï¼Œå˜¶ï¼Œä½†æ˜¯è¿™å°±ä¸ä¼šåŠ¨æ€æ›´æ–°äº†ï¼Œé€šçŸ¥ç³»ç»Ÿè¯¥æ€ä¹ˆåšå‘¢ï¼Ÿ
    `related_id` BIGINT DEFAULT NULL COMMENT 'å…³è”IDï¼ˆå¸–å­/è¯„è®º/ç”¨æˆ·ï¼‰',
    `sender_id` BIGINT DEFAULT NULL COMMENT 'å‘é€è€…ID',
    `is_read` BOOLEAN DEFAULT FALSE COMMENT 'æ˜¯å¦å·²è¯»',
    `create_time` DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
    PRIMARY KEY (`id`),
    KEY `idx_user_id` (`user_id`),
    KEY `idx_is_read` (`is_read`),
    KEY `idx_create_time` (`create_time`),
    CONSTRAINT `fk_notifications_users` FOREIGN KEY (`user_id`) REFERENCES `users` (`id`) ON DELETE CASCADE,
    CONSTRAINT `fk_notifications_sender` FOREIGN KEY (`sender_id`) REFERENCES `users` (`id`) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='é€šçŸ¥è¡¨';
```

**é€šçŸ¥ç±»å‹è¯´æ˜ï¼š**
- 1: ç‚¹èµï¼ˆxxxç‚¹èµäº†ä½ çš„å¸–å­ï¼‰
- 2: è¯„è®ºï¼ˆxxxè¯„è®ºäº†ä½ çš„å¸–å­ï¼‰
- 3: å…³æ³¨ï¼ˆxxxå…³æ³¨äº†ä½ ï¼‰
- 4: ç³»ç»Ÿï¼ˆç³»ç»Ÿå…¬å‘Šï¼‰
- 5: ç§ä¿¡ï¼ˆæ”¶åˆ°æ–°ç§ä¿¡ï¼‰
- 6: @æåŠï¼ˆxxxåœ¨è¯„è®ºä¸­@äº†ä½ ï¼‰

---

### 9. ç§ä¿¡è¡¨ï¼ˆmessagesï¼‰

```sql
DROP TABLE IF EXISTS `messages`;
CREATE TABLE `messages` (
    `id` BIGINT NOT NULL AUTO_INCREMENT COMMENT 'ç§ä¿¡ID',
    `sender_id` BIGINT NOT NULL COMMENT 'å‘é€è€…ID',
    `receiver_id` BIGINT NOT NULL COMMENT 'æ¥æ”¶è€…ID',
    `content` TEXT NOT NULL COMMENT 'ç§ä¿¡å†…å®¹',
    `is_read` BOOLEAN DEFAULT FALSE COMMENT 'æ˜¯å¦å·²è¯»',
    `create_time` DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT 'å‘é€æ—¶é—´',
    PRIMARY KEY (`id`),
    KEY `idx_sender` (`sender_id`),
    KEY `idx_receiver` (`receiver_id`),
    KEY `idx_create_time` (`create_time`),
    CONSTRAINT `fk_messages_sender` FOREIGN KEY (`sender_id`) REFERENCES `users` (`id`) ON DELETE CASCADE,
    CONSTRAINT `fk_messages_receiver` FOREIGN KEY (`receiver_id`) REFERENCES `users` (`id`) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='ç§ä¿¡è¡¨';
```

---

### 10. ä¸¾æŠ¥è¡¨ï¼ˆreportsï¼‰

```sql
DROP TABLE IF EXISTS `reports`;
CREATE TABLE `reports` (
    `id` BIGINT NOT NULL AUTO_INCREMENT COMMENT 'ä¸¾æŠ¥ID',
    `reporter_id` BIGINT NOT NULL COMMENT 'ä¸¾æŠ¥äººID',
    `target_id` BIGINT NOT NULL COMMENT 'è¢«ä¸¾æŠ¥å¯¹è±¡ID',
    `target_type` TINYINT NOT NULL COMMENT 'ç±»å‹ï¼š1å¸–å­,2è¯„è®º,3ç”¨æˆ·',
    `reason` VARCHAR(500) NOT NULL COMMENT 'ä¸¾æŠ¥åŸå› ',
    `status` TINYINT DEFAULT 0 COMMENT 'çŠ¶æ€ï¼š0å¾…å¤„ç†,1å·²å¤„ç†,2å·²é©³å›',
    `handler_id` BIGINT DEFAULT NULL COMMENT 'å¤„ç†äººID',
    `handle_result` VARCHAR(500) DEFAULT NULL COMMENT 'å¤„ç†ç»“æœ',
    `create_time` DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT 'ä¸¾æŠ¥æ—¶é—´',
    `handle_time` DATETIME DEFAULT NULL COMMENT 'å¤„ç†æ—¶é—´',
    PRIMARY KEY (`id`),
    KEY `idx_status` (`status`),
    KEY `idx_target` (`target_id`, `target_type`),
    KEY `idx_create_time` (`create_time`),
    CONSTRAINT `fk_reports_reporter` FOREIGN KEY (`reporter_id`) REFERENCES `users` (`id`) ON DELETE CASCADE,
    CONSTRAINT `fk_reports_handler` FOREIGN KEY (`handler_id`) REFERENCES `users` (`id`) ON DELETE SET NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='ä¸¾æŠ¥è¡¨';
```

---

### 11. æµè§ˆå†å²è¡¨ï¼ˆbrowsing_historyï¼‰

```sql
DROP TABLE IF EXISTS `browsing_history`;
CREATE TABLE `browsing_history` (
    `id` BIGINT NOT NULL AUTO_INCREMENT COMMENT 'å†å²ID',
    `user_id` BIGINT NOT NULL COMMENT 'ç”¨æˆ·ID',
    `post_id` BIGINT NOT NULL COMMENT 'å¸–å­ID',
    `view_time` DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT 'æµè§ˆæ—¶é—´',
    PRIMARY KEY (`id`),
    KEY `idx_user_time` (`user_id`, `view_time` DESC),
    KEY `idx_post_id` (`post_id`),
    CONSTRAINT `fk_history_users` FOREIGN KEY (`user_id`) REFERENCES `users` (`id`) ON DELETE CASCADE,
    CONSTRAINT `fk_history_posts` FOREIGN KEY (`post_id`) REFERENCES `posts` (`id`) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='æµè§ˆå†å²è¡¨';
```

**ä¼˜åŒ–å»ºè®®ï¼š**
- å®šæœŸæ¸…ç†æ—§æ•°æ®ï¼ˆåªä¿ç•™æœ€è¿‘3ä¸ªæœˆï¼‰
- å¯ä»¥è€ƒè™‘ç”¨Rediså­˜å‚¨ï¼Œå®šæœŸåŒæ­¥åˆ°MySQL

---

## ğŸ”— è¡¨å…³ç³»å›¾

```
users (ç”¨æˆ·è¡¨)
  â”œâ”€ 1:N â”€> posts (å‘å¸ƒå¸–å­)
  â”œâ”€ 1:N â”€> comments (å‘è¡¨è¯„è®º)
  â”œâ”€ M:N â”€> posts (ç‚¹èµ, é€šè¿‡likesè¡¨)
  â”œâ”€ M:N â”€> posts (æ”¶è—, é€šè¿‡collectsè¡¨)
  â”œâ”€ M:N â”€> comments (ç‚¹èµè¯„è®º, é€šè¿‡likesè¡¨)
  â”œâ”€ M:N â”€> users (å…³æ³¨, é€šè¿‡followsè¡¨)
  â”œâ”€ 1:N â”€> notifications (æ¥æ”¶é€šçŸ¥)
  â””â”€ 1:N â”€> browsing_history (æµè§ˆå†å²)

posts (å¸–å­è¡¨)
  â”œâ”€ N:1 â”€> users (ä½œè€…)
  â”œâ”€ N:1 â”€> categories (æ‰€å±åˆ†åŒº)
  â””â”€ 1:N â”€> comments (åŒ…å«è¯„è®º)

comments (è¯„è®ºè¡¨)
  â”œâ”€ N:1 â”€> posts (æ‰€å±å¸–å­)
  â”œâ”€ N:1 â”€> users (è¯„è®ºè€…)
  â””â”€ 1:N â”€> comments (æ¥¼ä¸­æ¥¼å›å¤, self-join)

categories (åˆ†åŒºè¡¨)
  â””â”€ 1:N â”€> posts (åŒ…å«å¸–å­)
```

---

## ğŸ“ˆ ç´¢å¼•ä¼˜åŒ–å»ºè®®

### å¸¸ç”¨æŸ¥è¯¢åœºæ™¯çš„ç´¢å¼•

1. **æŸ¥è¯¢ç”¨æˆ·çš„æ‰€æœ‰å¸–å­ï¼ˆæŒ‰æ—¶é—´é™åºï¼‰**
```sql
-- ä½¿ç”¨ç´¢å¼•: idx_user_id, idx_create_time
SELECT * FROM posts WHERE user_id = ? ORDER BY create_time DESC;
```

2. **æŸ¥è¯¢çƒ­é—¨å¸–å­ï¼ˆæŒ‰ç‚¹èµæ•°ï¼‰**
```sql
-- ä½¿ç”¨ç»„åˆç´¢å¼•: idx_hot
SELECT * FROM posts 
WHERE status = 2 
ORDER BY like_count DESC, comment_count DESC 
LIMIT 20;
```

3. **æŸ¥è¯¢æŸä¸ªåˆ†åŒºçš„å¸–å­**
```sql
-- ä½¿ç”¨ç´¢å¼•: idx_category_id, idx_update_time
SELECT * FROM posts 
WHERE category_id = ? AND status = 2 
ORDER BY update_time DESC;
```

4. **æŸ¥è¯¢æŸä¸ªå¸–å­çš„è¯„è®º**
```sql
-- ä½¿ç”¨ç´¢å¼•: idx_post_id, idx_create_time
SELECT * FROM comments 
WHERE post_id = ? AND is_deleted = FALSE 
ORDER BY create_time DESC;
```

---

## ğŸ¯ æ•°æ®è¿ç§»è„šæœ¬ï¼ˆä»æ—§è¡¨åˆ°æ–°è¡¨ï¼‰

```sql
-- å¦‚æœå·²æœ‰æ•°æ®éœ€è¦è¿ç§»ï¼Œæ‰§è¡Œä»¥ä¸‹è¯­å¥è¡¥å……å­—æ®µ

-- è¡¥å……usersè¡¨å­—æ®µ
ALTER TABLE users ADD COLUMN avatar_url VARCHAR(255) DEFAULT '/default-avatar.png' COMMENT 'å¤´åƒURL';
ALTER TABLE users ADD COLUMN gender TINYINT DEFAULT 0 COMMENT 'æ€§åˆ«ï¼š0æœªçŸ¥,1ç”·,2å¥³';
ALTER TABLE users ADD COLUMN bio VARCHAR(500) DEFAULT '' COMMENT 'ä¸ªäººç®€ä»‹';
ALTER TABLE users ADD COLUMN location VARCHAR(100) DEFAULT '' COMMENT 'æ‰€åœ¨åœ°';
ALTER TABLE users ADD COLUMN points INT DEFAULT 0 COMMENT 'ç§¯åˆ†';
ALTER TABLE users ADD COLUMN level INT DEFAULT 1 COMMENT 'ç”¨æˆ·ç­‰çº§';
ALTER TABLE users ADD COLUMN is_banned BOOLEAN DEFAULT FALSE COMMENT 'æ˜¯å¦è¢«å°ç¦';
ALTER TABLE users ADD COLUMN ban_reason VARCHAR(255) COMMENT 'å°ç¦åŸå› ';
ALTER TABLE users ADD COLUMN ban_until DATETIME COMMENT 'å°ç¦æˆªæ­¢æ—¶é—´';

-- è¡¥å……postsè¡¨å­—æ®µ
ALTER TABLE posts ADD COLUMN category_id BIGINT DEFAULT NULL COMMENT 'åˆ†åŒºID';
ALTER TABLE posts ADD COLUMN cover_image VARCHAR(255) DEFAULT NULL COMMENT 'å°é¢å›¾URL';
ALTER TABLE posts ADD COLUMN view_count INT DEFAULT 0 COMMENT 'æµè§ˆé‡';
ALTER TABLE posts ADD COLUMN like_count INT DEFAULT 0 COMMENT 'ç‚¹èµæ•°';
ALTER TABLE posts ADD COLUMN collect_count INT DEFAULT 0 COMMENT 'æ”¶è—æ•°';
ALTER TABLE posts ADD COLUMN comment_count INT DEFAULT 0 COMMENT 'è¯„è®ºæ•°';
ALTER TABLE posts ADD COLUMN status TINYINT DEFAULT 2 COMMENT 'çŠ¶æ€ï¼š0è‰ç¨¿,1å¾…å®¡æ ¸,2å·²å‘å¸ƒ,3å·²æ‹’ç»,4å·²åˆ é™¤';
ALTER TABLE posts ADD COLUMN is_pinned BOOLEAN DEFAULT FALSE COMMENT 'æ˜¯å¦ç½®é¡¶';
ALTER TABLE posts ADD COLUMN is_essence BOOLEAN DEFAULT FALSE COMMENT 'æ˜¯å¦åŠ ç²¾';
ALTER TABLE posts ADD COLUMN ip_address VARCHAR(50) COMMENT 'å‘å¸ƒè€…IP';

-- æ·»åŠ ç´¢å¼•
ALTER TABLE posts ADD INDEX idx_category_id (category_id);
ALTER TABLE posts ADD INDEX idx_status (status);
ALTER TABLE posts ADD INDEX idx_view_count (view_count);
ALTER TABLE posts ADD INDEX idx_like_count (like_count);
ALTER TABLE posts ADD INDEX idx_hot (like_count, comment_count, view_count);

-- è¡¥å……commentsè¡¨å­—æ®µ
ALTER TABLE comments ADD COLUMN parent_id BIGINT DEFAULT NULL COMMENT 'çˆ¶è¯„è®ºID';
ALTER TABLE comments ADD COLUMN reply_to_user_id BIGINT DEFAULT NULL COMMENT 'å›å¤ç»™è°';
ALTER TABLE comments ADD COLUMN like_count INT DEFAULT 0 COMMENT 'ç‚¹èµæ•°';
ALTER TABLE comments ADD COLUMN is_deleted BOOLEAN DEFAULT FALSE COMMENT 'æ˜¯å¦åˆ é™¤';

-- æ·»åŠ å¤–é”®çº¦æŸ
ALTER TABLE posts ADD CONSTRAINT fk_posts_categories 
FOREIGN KEY (category_id) REFERENCES categories(id) ON DELETE SET NULL;

ALTER TABLE comments ADD CONSTRAINT fk_comments_parent 
FOREIGN KEY (parent_id) REFERENCES comments(id) ON DELETE CASCADE;

ALTER TABLE comments ADD CONSTRAINT fk_comments_reply_to 
FOREIGN KEY (reply_to_user_id) REFERENCES users(id) ON DELETE SET NULL;
```

---

## âœ… æ•°æ®åº“åˆå§‹åŒ–æ£€æŸ¥æ¸…å•

- [ ] åˆ›å»ºæ•°æ®åº“ï¼š`CREATE DATABASE tech_forum CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;`
- [ ] æ‰§è¡Œ13å¼ è¡¨çš„å»ºè¡¨SQL
- [ ] æ£€æŸ¥æ‰€æœ‰å¤–é”®çº¦æŸæ˜¯å¦åˆ›å»ºæˆåŠŸ
- [ ] æ‰§è¡Œcategoriesåˆå§‹åŒ–æ•°æ®SQL
- [ ] éªŒè¯ç´¢å¼•æ˜¯å¦åˆ›å»ºæˆåŠŸï¼š`SHOW INDEX FROM posts;`
- [ ] åˆ›å»ºæµ‹è¯•æ•°æ®ï¼ˆ10ä¸ªç”¨æˆ·ã€50ä¸ªå¸–å­ã€200æ¡è¯„è®ºï¼‰
- [ ] æµ‹è¯•å¸¸ç”¨æŸ¥è¯¢çš„æ€§èƒ½

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
**æœ€åæ›´æ–°**: 2025-01-15