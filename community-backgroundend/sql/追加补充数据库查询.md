ALTER TABLE users ADD column avatar_url VARCHAR(255) DEFAULT '/default-avatar.png' COMMENT '头像URL';
ALTER TABLE users ADD COLUMN gender TINYINT DEFAULT 0 COMMENT '性别：0未知,1男,2女';
ALTER TABLE users ADD COLUMN bio VARCHAR(500) DEFAULT '' COMMENT '个人简介';
ALTER TABLE users ADD COLUMN location VARCHAR(100) DEFAULT '' COMMENT '所在地';
ALTER TABLE users ADD COLUMN points INT DEFAULT 0 COMMENT '积分';
ALTER TABLE users ADD COLUMN level INT DEFAULT 1 COMMENT '用户等级';
ALTER TABLE users ADD COLUMN is_banned BOOLEAN DEFAULT FALSE COMMENT '是否被封禁';
ALTER TABLE users ADD COLUMN ban_reason VARCHAR(255) COMMENT '封禁原因';
ALTER TABLE users ADD COLUMN ban_until DATETIME COMMENT '封禁截止时间';

-- 补充posts表字段
ALTER TABLE posts ADD COLUMN category_id BIGINT DEFAULT NULL COMMENT '分区ID';
ALTER TABLE posts ADD COLUMN cover_image VARCHAR(255) DEFAULT NULL COMMENT '封面图URL';
ALTER TABLE posts ADD COLUMN view_count INT DEFAULT 0 COMMENT '浏览量';
ALTER TABLE posts ADD COLUMN like_count INT DEFAULT 0 COMMENT '点赞数';
ALTER TABLE posts ADD COLUMN collect_count INT DEFAULT 0 COMMENT '收藏数';
ALTER TABLE posts ADD COLUMN comment_count INT DEFAULT 0 COMMENT '评论数';
ALTER TABLE posts ADD COLUMN status TINYINT DEFAULT 2 COMMENT '状态：0草稿,1待审核,2已发布,3已拒绝,4已删除';
ALTER TABLE posts ADD COLUMN is_pinned BOOLEAN DEFAULT FALSE COMMENT '是否置顶';
ALTER TABLE posts ADD COLUMN is_essence BOOLEAN DEFAULT FALSE COMMENT '是否加精';
ALTER TABLE posts ADD COLUMN ip_address VARCHAR(50) COMMENT '发布者IP';

-- 添加索引
ALTER TABLE posts ADD INDEX idx_category_id (category_id);
ALTER TABLE posts ADD INDEX idx_status (status);
ALTER TABLE posts ADD INDEX idx_view_count (view_count);
ALTER TABLE posts ADD INDEX idx_like_count (like_count);
ALTER TABLE posts ADD INDEX idx_hot (like_count, comment_count, view_count);

-- 补充comments表字段
ALTER TABLE comments ADD COLUMN parent_id BIGINT DEFAULT NULL COMMENT '父评论ID';
ALTER TABLE comments ADD COLUMN reply_to_user_id BIGINT DEFAULT NULL COMMENT '回复给谁';
ALTER TABLE comments ADD COLUMN like_count INT DEFAULT 0 COMMENT '点赞数';
ALTER TABLE comments ADD COLUMN is_deleted BOOLEAN DEFAULT FALSE COMMENT '是否删除';

-- 添加外键约束
-- 实现分区消失帖子一同消失
ALTER TABLE posts ADD CONSTRAINT fk_posts_categories 
FOREIGN KEY (category_id) REFERENCES categories(id) ON DELETE SET NULL;

--实现父级评论消失，子评论也消失
ALTER TABLE comments ADD CONSTRAINT fk_comments_parent 
FOREIGN KEY (parent_id) REFERENCES comments(id) ON DELETE CASCADE;

--实现用户注销后被回复的评论也消失
ALTER TABLE comments ADD CONSTRAINT fk_comments_reply_to 
FOREIGN KEY (reply_to_user_id) REFERENCES users(id) ON DELETE SET NULL;